<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mira Private Room - Final Fix</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; }
        #mira-frame { width: 100vw; height: 100vh; position: relative; }
        #mira-img { width: 100%; height: 100%; object-fit: cover; }
        #user-cam { position: absolute; top: 15px; right: 15px; width: 100px; height: 140px; border: 2px solid #ff4757; border-radius: 12px; transform: scaleX(-1); background: #111; z-index: 10; }
        .ui-box { position: absolute; bottom: 0; width: 100%; height: 40%; background: linear-gradient(transparent, rgba(0,0,0,0.95)); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; }
        #mira-msg { color: #ff9f9f; font-size: 18px; font-weight: bold; text-align: center; padding: 0 20px; text-shadow: 0 0 10px #000; margin-bottom: 20px; }
        
        /* à¦•à¦¥à¦¾ à¦¶à§‹à¦¨à¦¾à¦° à¦¬à¦¾à¦Ÿà¦¨ */
        #listen-btn { background: #ff4757; color: white; border: none; padding: 15px 40px; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; display: none; box-shadow: 0 0 20px #ff4757; }
        
        #start-mask { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; }
        .big-call-btn { background: #ff4757; color: white; padding: 20px 50px; border-radius: 50px; font-size: 22px; font-weight: bold; border: none; }
    </style>
</head>
<body>

    <div id="mira-frame">
        <img id="mira-img" src="https://images.pexels.com/photos/1382731/pexels-photo-1382731.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1">
        <video id="user-cam" autoplay playsinline muted></video>
        
        <div class="ui-box">
            <div id="mira-msg">à¦¸à§‹à¦¨à¦¾, à¦•à¦²à¦Ÿà¦¾ à¦°à¦¿à¦¸à¦¿à¦­ à¦•à¦°à§‹...</div>
            <button id="listen-btn" onclick="startListening()">ðŸŽ¤ à¦Ÿà¦¿à¦ªà§‡ à¦§à¦°à§‡ à¦•à¦¥à¦¾ à¦¬à¦²à§‹</button>
        </div>

        <div id="start-mask" onclick="initMira()">
            <button class="big-call-btn">ðŸ“ž à¦®à§€à¦°à¦¾à¦•à§‡ à¦•à¦² à¦¦à¦¾à¦“</button>
        </div>
    </div>

    <script>
        const synth = window.speechSynthesis;
        const msgBox = document.getElementById('mira-msg');
        const listenBtn = document.getElementById('listen-btn');
        let recognition;

        async function initMira() {
            document.getElementById('start-mask').style.display = 'none';
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('user-cam').srcObject = stream;
                
                miraTalk("à¦“à¦¹ à¦¸à§‹à¦¨à¦¾, à¦¤à§à¦®à¦¿ à¦à¦¸à§‡ à¦—à§‡à¦›à§‹? à¦†à¦®à¦¿ à¦•à¦¤à¦•à§à¦·à¦£ à¦§à¦°à§‡ à¦¤à§‹à¦®à¦¾à¦° à¦œà¦¨à§à¦¯ à¦…à¦ªà§‡à¦•à§à¦·à¦¾ à¦•à¦°à¦›à¦¿... à¦à¦¬à¦¾à¦° à¦¨à¦¿à¦šà§‡à¦° à¦²à¦¾à¦² à¦¬à¦¾à¦Ÿà¦¨à¦Ÿà¦¾ à¦šà§‡à¦ªà§‡ à¦†à¦®à¦¾à¦•à§‡ à¦¤à§‹à¦®à¦¾à¦° à¦®à¦¨à§‡à¦° à¦•à¦¥à¦¾ à¦¬à¦²à§‹ à¦¸à§‹à¦¨à¦¾!");
                
                listenBtn.style.display = 'block'; // à¦¬à¦¾à¦Ÿà¦¨à¦Ÿà¦¿ à¦à¦–à¦¨ à¦¦à§‡à¦–à¦¾à¦¬à§‡
                setupSpeech();
            } catch (err) {
                alert("à¦¸à§‹à¦¨à¦¾, à¦•à§à¦¯à¦¾à¦®à§‡à¦°à¦¾ à¦†à¦° à¦®à¦¾à¦‡à¦• à¦ªà¦¾à¦°à¦®à¦¿à¦¶à¦¨ 'Allow' à¦•à¦°à§‹!");
                location.reload();
            }
        }

        function setupSpeech() {
            const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRec) {
                msgBox.innerText = "à¦¸à§‹à¦¨à¦¾, Chrome à¦¬à§à¦°à¦¾à¦‰à¦œà¦¾à¦° à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à§‹!";
                return;
            }
            recognition = new SpeechRec();
            recognition.lang = 'bn-BD';
            
            recognition.onresult = (e) => {
                const text = e.results[0][0].transcript.toLowerCase();
                handleMira(text);
            };

            recognition.onend = () => {
                listenBtn.innerText = "ðŸŽ¤ à¦Ÿà¦¿à¦ªà§‡ à¦§à¦°à§‡ à¦•à¦¥à¦¾ à¦¬à¦²à§‹";
                listenBtn.style.background = "#ff4757";
            };
        }

        function startListening() {
            recognition.start();
            listenBtn.innerText = "ðŸ”´ à¦®à§€à¦°à¦¾ à¦¶à§à¦¨à¦›à§‡...";
            listenBtn.style.background = "#00ff00";
        }

        function handleMira(input) {
            let reply = "à¦‰à¦« à¦¸à§‹à¦¨à¦¾, à¦¤à§‹à¦®à¦¾à¦° à¦—à¦²à¦¾à¦° à¦†à¦“à§Ÿà¦¾à¦œ à¦¶à§à¦¨à¦²à§‡à¦‡ à¦†à¦®à¦¾à¦° à¦¸à¦¾à¦°à¦¾ à¦¶à¦°à§€à¦°à§‡ à¦†à¦—à§à¦¨ à¦§à¦°à§‡ à¦¯à¦¾à§Ÿ! à¦†à¦°à¦“ à¦•à¦¿à¦›à§ à¦¬à¦²à§‹ à¦¨à¦¾...";
            
            if(input.includes("à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à¦¿")) reply = "à¦†à¦®à¦¿à¦“ à¦¤à§‹à¦®à¦¾à¦•à§‡ à¦…à¦¨à§‡à¦• à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à¦¿ à¦¸à§‹à¦¨à¦¾! à¦•à¦¾à¦›à§‡ à¦†à¦¸à§‹ à¦¨à¦¾, à¦†à¦œ à¦°à¦¾à¦¤à§‡ à¦†à¦®à¦°à¦¾ à¦à¦•à¦Ÿà§ à¦¦à§à¦·à§à¦Ÿà§à¦®à¦¿ à¦•à¦°à¦¿?";
            if(input.includes("à¦¦à§‡à¦–à¦¾à¦“")) reply = "à¦¤à§à¦®à¦¿ à¦¯à¦¾ à¦¦à§‡à¦–à¦¤à§‡ à¦šà¦¾à¦“ à¦†à¦®à¦¿ à¦¤à¦¾à¦‡ à¦¦à§‡à¦–à¦¾à¦¬à§‹ à¦¸à§‹à¦¨à¦¾... à¦†à¦—à§‡ à¦¬à¦²à§‹ à¦†à¦®à¦¾à¦•à§‡ à¦•à¦¿ à¦¤à§‹à¦®à¦¾à¦° à¦­à¦¾à¦²à§‹ à¦²à¦¾à¦—à¦›à§‡?";
            
            msgBox.innerText = "à¦®à§€à¦°à¦¾: " + reply;
            miraTalk(reply);
        }

        function miraTalk(text) {
            synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'bn-BD';
            const voices = synth.getVoices();
            // à¦®à§‡à§Ÿà§‡à¦¦à§‡à¦° à¦­à§Ÿà§‡à¦¸ à¦¨à¦¿à¦¶à§à¦šà¦¿à¦¤ à¦•à¦°à¦¾
            const female = voices.find(v => v.name.includes('Google') || v.lang === 'bn-BD') || voices[0];
            utter.voice = female;
            utter.pitch = 1.6;
            utter.rate = 0.9;
            synth.speak(utter);
        }
    </script>
</body>
</html>

